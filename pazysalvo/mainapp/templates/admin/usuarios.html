{% load static %}
<link rel="stylesheet" href="{% static 'css/aprendices.css' %}">

<div class="aprendices-container">

  <div class="barra-superior">
    {% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

    <a  href="{% url 'inicio' %}" class="btn-volver"> Volver</a>
    <h1>Lista de Usuarios</h1>
    <a href="#" id="btn-abrir-modal" class="btn-crear">+ Crear Usuario</a>

  </div>

  <input type="text" id="busqueda" placeholder="Buscar por nombre o documento...">

<table id="tabla-aprendices">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Documento</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for usuario in usuarios %}
    <tr>
      <td>{{ usuario.nombre }} {{ usuario.apellidos }}</td>
      <td>{{ usuario.num_doc }}</td>
      <td>{{ usuario.id_rol_FK.nombre_rol }}</td>
      <td>
        <a href="#" class="btn-editar" 
          data-id="{{ usuario.id }}"
          data-nombre="{{ usuario.nombre }}"
          data-apellidos="{{ usuario.apellidos }}"
          data-num_doc="{{ usuario.num_doc }}"
          data-tipodoc="{{ usuario.id_tipodoc_FK.id }}"
          data-rol="{{ usuario.id_rol_FK.id }}"
          data-ficha="{{ usuario.id_ficha_FK.id }}">
          Editar
        </a>

        <form method="post" action="{% url 'eliminar_usuario' usuario.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn-eliminar" onclick="return confirm('¿Seguro que deseas eliminar este usuario?')">Eliminar</button>
        </form>

      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="4">No hay usuarios registrados.</td>
    </tr>
  {% endfor %}
</tbody>

</table>

{% include 'modales/modalCrearUsuario.html' %}
{% include 'modales/modalEditarUsuario.html' %}


</div>

<script>
  const inputBusqueda = document.getElementById('busqueda');
  const filas = document.querySelectorAll('#tabla-aprendices tbody tr');

  inputBusqueda.addEventListener('keyup', () => {
    const valor = inputBusqueda.value.toLowerCase();
    filas.forEach(fila => {
      const texto = fila.innerText.toLowerCase();
      fila.style.display = texto.includes(valor) ? '' : 'none';
    });
  });
</script>
<script>
  const modal = document.getElementById('modal-crear');
  const btnAbrir = document.getElementById('btn-abrir-modal');
  const btnCancelar = document.getElementById('btn-cancelar');

  btnAbrir.addEventListener('click', () => {
    modal.style.display = 'flex';
  });

  btnCancelar.addEventListener('click', () => {
    modal.style.display = 'none';
  });
</script>
<script>
  const modalEditar = document.getElementById('modal-editar');
  const btnsEditar = document.querySelectorAll('.btn-editar');
  const btnCancelarEditar = document.getElementById('btn-cancelar-editar');
  const formEditar = document.getElementById('form-editar');

  btnsEditar.forEach(btn => {
    btn.addEventListener('click', function () {
      const id = this.dataset.id;
      const nombre = this.dataset.nombre;
      const apellidos = this.dataset.apellidos;
      const num_doc = this.dataset.num_doc;
      const tipodoc = this.dataset.tipodoc;
      const rol = this.dataset.rol;
      const ficha = this.dataset.ficha;

      document.getElementById('editar-usuario-id').value = id;
      document.getElementById('editar-nombre').value = nombre;
      document.getElementById('editar-apellidos').value = apellidos;
      document.getElementById('editar-num_doc').value = num_doc;
      document.getElementById('editar-id_tipodoc').value = tipodoc;
      document.getElementById('editar-id_rol').value = rol;
      document.getElementById('editar-id_ficha').value = ficha;

      // Cambiar acción del formulario
      formEditar.action = `/usuarios/editar/${id}/`;

      modalEditar.style.display = 'flex';
    });
  });

  btnCancelarEditar.addEventListener('click', () => {
    modalEditar.style.display = 'none';
  });
</script>
</div>


