<div id="modal-editar" class="modal" style="display: none;">
  <div class="modal-contenido">
    <h2>Editar Usuario</h2>
    <form id="form-editar" method="post">
      {% csrf_token %}
      <input type="hidden" name="usuario_id" id="editar-usuario-id">

      <div class="form-group">
        <label for="editar-nombre">Nombre</label>
        <input type="text" id="editar-nombre" name="nombre"  class="form-control" required>
      </div>

      <div class="form-group">
        <label for="editar-apellidos">Apellidos</label>
        <input type="text" id="editar-apellidos" name="apellidos" class="form-control" required>
      </div>

      <div class="form-group">
        <label for="editar-num_doc">Número de Documento</label>
        <input type="text" id="editar-num_doc" name="num_doc" class="form-control" required>
      </div>

      <div class="form-group">
        <select name="id_tipodoc_FK" id="editar-id_tipodoc" class="form-control" required>
          {% for tipo in tipos_doc %}
            <option value="{{ tipo.id }}" {% if tipo.id == usuario.id_tipodoc_FK.id %}selected{% endif %}>
              {{ tipo.nombre_tipo }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="editar-id_rol">Rol</label>
        <select name="id_rol_FK" id="editar-id_rol" class="form-control" required>
          {% for rol in roles %}
            <option value="{{ rol.id }}" {% if rol.id == usuario.id_rol_FK.id %}selected{% endif %}>
              {{ rol.nombre_rol }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group" id="campo-password" style="display: none;">
        <label for="editar-password">Nueva Contraseña</label>
        <input type="password" name="password" placeholder="Nueva contraseña (opcional)" class="form-control" />
      </div>

      <div class="form-group" id="campo-ficha">
      <label for="editar-id_ficha">Ficha</label>
      <select name="id_ficha_FK" id="editar-id_ficha" class="form-control">
        {% for ficha in fichas %}
          <option value="{{ ficha.id }}" {% if ficha.id == usuario.id_ficha_FK_id.id %}selected{% endif %}>
            {{ ficha.num_ficha }}
          </option>
        {% endfor %}
      </select>
    </div>

      <div class="modal-botones">
        <button type="submit" class="btn-guardar">Guardar Cambios</button>
        <button type="button" id="btn-cancelar-editar" class="btn-cancelar">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<script>
  const selectRol = document.getElementById('editar-id_rol');
  const campoFicha = document.getElementById('campo-ficha');
  const campoPassword = document.getElementById('campo-password');

  function toggleCamposSegunRol() {
    const rolSeleccionado = selectRol.options[selectRol.selectedIndex].text.toLowerCase();

    if (rolSeleccionado.includes('aprendiz')) {
      campoFicha.style.display = 'block';
      campoPassword.style.display = 'none';
    } else {
      campoFicha.style.display = 'none';
      campoPassword.style.display = 'block';
    }
  }

  // Ejecutar al cargar la ventana
  window.addEventListener('DOMContentLoaded', toggleCamposSegunRol);

  // Ejecutar cada vez que cambia el select
  selectRol.addEventListener('change', toggleCamposSegunRol);
</script>
