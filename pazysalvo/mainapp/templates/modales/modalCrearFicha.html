<!-- Modal Crear Usuario -->
<div id="modal-crear" class="modal" style="display: none;">
  <div class="modal-contenido">
    <h3>Crear Nuevo Usuario</h3>
    <form method="post" action="{% url 'crear_usuario' %}">
      {% csrf_token %}
      <div class="form-grupo">
        <label for="nombre">Numero Ficha</label>
        <input type="text" name="nombre" class="form-control" required>
      </div>
      <div class="form-grupo">
        <label for="id_tipodoc_FK">Tipo de Documento</label>
        <select name="id_tipodoc_FK" class="form-control">
          {% for tipo in tipos_doc %}
            <option value="{{ tipo.id }}">{{ tipo.nombre_tipo }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-grupo">
        <label for="id_rol_FK">Rol</label>
        <select name="id_rol_FK" id="id_rol_FK" class="form-control">
          {% for rol in roles %}
            <option value="{{ rol.id }}">{{ rol.nombre_rol }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Campo Ficha (solo para rol Aprendiz) -->
      <div class="form-grupo" id="grupo-ficha" style="display: none;">
        <label for="id_ficha_FK">Ficha</label>
        <select name="id_ficha_FK" class="form-control">
          {% for ficha in fichas %}
            <option value="{{ ficha.num_ficha }}">{{ ficha.num_ficha }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Campo Contraseña (para otros roles) -->
      <div class="form-grupo" id="grupo-password" style="display: none;">
        <label for="password">Contraseña</label>
        <input type="password" name="password" class="form-control" minlength="4">
      </div>

      <div class="modal-botones">
        <button type="button" id="btn-cancelar" class="btn-cancelar">Cancelar</button>
        <button type="submit" class="btn-verde">Guardar</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rolSelect = document.getElementById('id_rol_FK');
    const fichaGrupo = document.getElementById('grupo-ficha');
    const passwordGrupo = document.getElementById('grupo-password');

    const mostrarCamposSegunRol = () => {
      const selectedRolText = rolSelect.options[rolSelect.selectedIndex].text.toLowerCase();

      if (selectedRolText === 'aprendiz') {
        fichaGrupo.style.display = 'block';
        passwordGrupo.style.display = 'none';
      } else {
        fichaGrupo.style.display = 'none';
        passwordGrupo.style.display = 'block';
      }
    };

    // Detectar cambio en el select
    rolSelect.addEventListener('change', mostrarCamposSegunRol);

    // Ejecutar una vez al cargar por si hay un rol preseleccionado
    mostrarCamposSegunRol();
  });
</script>